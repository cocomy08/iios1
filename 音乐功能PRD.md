# 🎵 "一起听" 音乐功能 PRD

> **产品需求文档 v1.0**  
> 创建日期：2026-01-04  
> 状态：草稿待评审

---

## 📋 文档导航

1. [安全性问题解答](#-先回答您的安全性问题)
2. [概述与目标](#-概述与目标)
3. [功能规格](#-功能规格)
4. [原型图构想](#-原型图构想描述给专业ai用)
5. [技术架构](#-技术架构概要)
6. [后续规划](#-后续规划)

---

## 🔐 先回答您的安全性问题

### Q1: 用户登录网易云账号是否有盗号风险？

| 风险类型           | 说明                                                               | 风险等级  |
| ------------------ | ------------------------------------------------------------------ | --------- |
| **OAuth 正规流程** | 用户在网易云官方页面登录，您的应用**只获得授权 Token**，看不到密码 | ✅ 低风险 |
| **Token 泄露**     | 如果您的服务器或代码被黑，Token 可能被盗用                         | ⚠️ 中风险 |
| **非官方 API**     | 如果使用非官方 API 要求用户输入账号密码，这**非常危险**            | ❌ 高风险 |

**结论**：只要使用**官方 OAuth 流程**，您确实看不到用户密码。但如果应用被黑，攻击者可能：

- 利用 Token 访问用户歌单等数据
- 无法修改密码或盗号（OAuth 权限有限）

---

### Q2: 开发者申请 API 让用户直接用的方法

**有的！这正是正确的做法。**

| 平台              | 开发者 API                                                          | 用户体验                                                |
| ----------------- | ------------------------------------------------------------------- | ------------------------------------------------------- |
| **Spotify**       | [Spotify for Developers](https://developer.spotify.com/) - 免费注册 | 用户点击登录 → 弹出 Spotify 授权页 → 授权后返回您的应用 |
| **网易云**        | ❌ **无官方开发者 API**                                             | 只能用非官方方案，法律风险高                            |
| **Apple Music**   | [MusicKit](https://developer.apple.com/musickit/)                   | 类似 Spotify，但需要 Apple 开发者账号($99/年)           |
| **YouTube Music** | 可通过 YouTube Data API v3 间接实现                                 | 需要 Google Cloud 账号                                  |

#### 🎯 推荐方案

```
优先级 1: Spotify Web API + Web Playback SDK
├── 开发者免费申请
├── 官方OAuth安全
├── 支持应用内播放
└── 国内用户可能需要VPN（这是问题）

优先级 2: 纯链接分享模式（作为降级方案）
├── 搜索歌曲（用第三方元数据API）
├── 生成卡片
└── 点击跳转到用户已有的音乐App
```

> [!WARNING] > **关于网易云**  
> 网易云没有官方开放 API。市面上的"网易云 API"都是逆向工程产物（如 NeteaseCloudMusicApi），存在：
>
> - 版权法律风险
> - 随时可能失效
> - 商业使用被追责风险
>
> **建议**：商业产品**不要**使用网易云非官方 API。可以支持"分享网易云链接"但不要代理播放。

---

## 📖 概述与目标

### 产品愿景

打造一个让用户与 AI 角色能够**共同沉浸式听歌**的功能，增强情感连接，提升产品粘性。

### 核心目标

| 目标           | 描述                                     |
| -------------- | ---------------------------------------- |
| **情感共鸣**   | 音乐是情感载体，让 AI 能对音乐产生"反应" |
| **差异化竞争** | 竞品没有这种深度音乐互动功能             |
| **用户粘性**   | "一起听"是强社交行为，增加使用时长       |
| **轻量实现**   | 不存本地音频文件，不做盗版播放器         |

---

## 🎯 功能规格

### 功能架构总览

```
┌─────────────────────────────────────────────────────────┐
│                    音乐功能总架构                        │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌─────────────┐     ┌─────────────┐     ┌───────────┐ │
│  │ 功能入口    │ ──▶ │ 邀请卡片    │ ──▶ │ 一起听    │ │
│  │(聊天+按钮)  │     │(发给AI)     │     │ 沉浸界面  │ │
│  └─────────────┘     └─────────────┘     └───────────┘ │
│         │                                       │       │
│         │                                       ▼       │
│         │            ┌─────────────────────────────┐   │
│         │            │      一起听核心功能          │   │
│         │            ├─────────────────────────────┤   │
│         │            │ • 音乐搜索与播放             │   │
│         │            │ • 歌单管理                   │   │
│         │            │ • 专属聊天窗口               │   │
│         │            │ • AI实时反馈                 │   │
│         │            │ • 退出与总结                 │   │
│         │            └─────────────────────────────┘   │
│         │                                       │       │
│         ▼                                       ▼       │
│  ┌─────────────┐                       ┌─────────────┐ │
│  │ 快速分享    │                       │ 会话总结    │ │
│  │ 音乐卡片    │                       │ 发到聊天    │ │
│  └─────────────┘                       └─────────────┘ │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

### F1. 功能入口

#### F1.1 聊天界面 + 按钮入口

| 要素     | 描述                    |
| -------- | ----------------------- |
| **位置** | 聊天界面底部加号菜单    |
| **图标** | 🎵 音乐符号             |
| **标签** | "一起听"                |
| **行为** | 点击后发送邀请卡片给 AI |

---

### F2. 邀请卡片

#### F2.1 邀请发送

用户点击入口后，聊天中自动发送一张**固定样式的邀请卡片**：

```
┌─────────────────────────────────┐
│  🎧  邀请 TA 一起听音乐          │
│                                 │
│  "想和你一起分享喜欢的歌曲..."   │
│                                 │
│  ┌──────────┐  ┌──────────┐    │
│  │  接受 ✓  │  │  拒绝 ✗  │    │
│  └──────────┘  └──────────┘    │
└─────────────────────────────────┘
```

| 要素         | 描述                                           |
| ------------ | ---------------------------------------------- |
| **卡片样式** | 固定精致设计，不显示具体歌曲                   |
| **AI 响应**  | AI 收到后会"选择"接受或拒绝（可基于人设/情绪） |
| **接受后**   | 弹出一起听沉浸界面                             |
| **拒绝后**   | AI 发送拒绝理由消息（如"现在不太想听歌..."）   |

#### F2.2 AI 决策逻辑

| 条件              | AI 行为        | 概率 |
| ----------------- | -------------- | ---- |
| 默认状态          | 接受           | 90%  |
| AI 设定为"高冷"   | 可能拒绝       | 30%  |
| 最近聊天氛围差    | 可能拒绝       | 20%  |
| 用户连续邀请 3 次 | 接受（不忍心） | 100% |

---

### F3. 一起听沉浸界面（核心）

#### F3.1 界面布局

```
┌─────────────────────────────────────┐
│ ← 最小化              🎵 一起听     │  ← 顶部导航栏
├─────────────────────────────────────┤
│                                     │
│         ┌─────────────┐             │
│         │             │             │
│         │   专辑封面   │             │  ← 封面区域（可视化动效）
│         │   动态效果   │             │
│         │             │             │
│         └─────────────┘             │
│                                     │
│       🎵 歌曲名称 - 歌手名           │
│        ───────●─────── 2:45/4:12   │  ← 进度条
│                                     │
│      ⏮️   ▶️/⏸️   ⏭️    🔀    📋    │  ← 播放控制
│                                     │
├─────────────────────────────────────┤
│  💬 和 TA 聊聊这首歌...              │  ← 专属聊天区域
│  ┌─────────────────────────────────┐│
│  │ AI: 这首歌的旋律好温柔...        ││
│  │ 你: 是啊，每次听都想起夏天       ││
│  │ AI: 🎵 [副歌响起]                ││
│  │     这段是我最喜欢的部分！       ││
│  └─────────────────────────────────┘│
│  ┌─────────────────────────────────┐│
│  │ 输入消息...              发送 📤││
│  └─────────────────────────────────┘│
├─────────────────────────────────────┤
│        [ 🚪 退出一起听 ]             │  ← 退出按钮
└─────────────────────────────────────┘
```

#### F3.2 功能详细说明

| 组件           | 功能                                         |
| -------------- | -------------------------------------------- |
| **最小化按钮** | 将一起听缩小为浮动胶囊，可回到日常聊天       |
| **封面区域**   | 显示专辑封面 + 可视化音频动效                |
| **进度条**     | 显示播放进度，可拖动跳转                     |
| **播放控制**   | 播放/暂停、上一首/下一首、随机播放、打开歌单 |
| **专属聊天**   | 仅限一起听话题的独立聊天，不污染日常记录     |
| **退出按钮**   | 结束一起听，生成总结                         |

---

### F4. 音乐搜索与播放

#### F4.1 搜索界面

```
┌─────────────────────────────────────┐
│ 🔍 搜索歌曲、歌手...                 │
├─────────────────────────────────────┤
│ 热门推荐                            │
│ ┌─────┐ ┌─────┐ ┌─────┐           │
│ │ 🎵 │ │ 🎵 │ │ 🎵 │           │
│ └─────┘ └─────┘ └─────┘           │
├─────────────────────────────────────┤
│ 搜索结果                            │
│ ┌─────────────────────────────────┐│
│ │ 🖼️ 晴天 - 周杰伦    [+ 添加]    ││
│ │ 🖼️ 稻香 - 周杰伦    [+ 添加]    ││
│ │ 🖼️ 七里香 - 周杰伦  [+ 添加]    ││
│ └─────────────────────────────────┘│
└─────────────────────────────────────┘
```

#### F4.2 播放能力分级

| 用户状态               | 播放能力                           |
| ---------------------- | ---------------------------------- |
| **未登录任何平台**     | 只能搜索、预览 30 秒、生成分享卡片 |
| **已登录 Spotify**     | 完整播放、歌单同步                 |
| **已登录 Apple Music** | 完整播放、歌单同步（如果实现）     |

---

### F5. 歌单系统

#### F5.1 共享歌单

```
┌─────────────────────────────────────┐
│ 📋 我们的歌单                        │
├─────────────────────────────────────┤
│ ┌─────────────────────────────────┐│
│ │ 🖼️ 晴天        你添加的          ││
│ │ 🖼️ 稻香        TA添加的 ✨       ││
│ │ 🖼️ 告白气球    你添加的          ││
│ │ 🖼️ ??         TA想删除这首 🗑️   ││
│ └─────────────────────────────────┘│
│                                     │
│ [ + 添加歌曲 ]  [ 🔀 随机播放 ]     │
└─────────────────────────────────────┘
```

#### F5.2 AI 歌单操作能力

| AI 行为        | 触发条件                  | UI 反馈                           |
| -------------- | ------------------------- | --------------------------------- |
| **添加歌曲**   | AI 在聊天中提到想听某首歌 | Toast: "TA 添加了《xxx》✨"       |
| **请求删除**   | AI 不喜欢当前歌曲         | 显示"TA 想删除这首"标记，用户确认 |
| **切歌**       | AI 表示不想听了           | 自动切到下一首 + 聊天提示         |
| **退出一起听** | AI 情绪低落/生气          | 提示"TA 想退出一起听"，用户确认   |

> [!IMPORTANT] > **防误解设计**  
> 所有 AI 主动行为必须有明确的 UI 提示，不能让用户以为是 BUG！

---

### F6. AI 实时反馈系统【需要调用 API，获取 AI 的实时反馈】

#### F6.1 触发点

| 触发点             | AI 可能的反馈                 |
| ------------------ | ----------------------------- |
| **歌曲播放开始**   | "这首歌我听过！/这是什么歌？" |
| **副歌响起**       | "这段旋律太棒了..."           |
| **歌词情感点**     | 根据歌词内容做出情感反应      |
| **用户切歌**       | "怎么不听了？/好吧，下一首"   |
| **播放很久没聊天** | 主动挑起话题                  |

#### F6.2 情绪可视化

| 歌曲氛围 | UI 变化                                     |
| -------- | ------------------------------------------- |
| **欢快** | 背景暖色调，AI 头像右上角有个微笑的 emoji   |
| **伤感** | 背景冷色调，AI 头像右上角有个悲伤的 emoji   |
| **摇滚** | 背景动效加强，AI 头像右上角有个摇滚的 emoji |

---

### F7. 最小化与浮动胶囊

当用户需要回到日常聊天时：

```
┌──────────────────────────────────────────┐
│               日常聊天界面                │
│                                          │
│  ┌──────────────────────────────────────┐│
│  │  AI: 那你今天工作怎么样？            ││
│  │  你: 还行吧，有点累                   ││
│  └──────────────────────────────────────┘│
│                                          │
│  ┌────────────────────┐                  │
│  │ 🎵 晴天 ▶ 2:45     │  ← 浮动音乐胶囊  │
│  └────────────────────┘                  │
│                                          │
└──────────────────────────────────────────┘
```

| 要素         | 描述                     |
| ------------ | ------------------------ |
| **浮动胶囊** | 显示当前播放歌曲 + 进度  |
| **点击胶囊** | 展开回到一起听沉浸界面   |
| **拖拽胶囊** | 可在屏幕边缘拖动位置     |
| **长按胶囊** | 快速控制：暂停/切歌/退出 |

---

### F8. 退出与总结

#### F8.1 退出流程

```
用户点击"退出一起听"
        ↓
    弹出确认框
    "确定退出吗？TA会收到通知哦~"
    [ 取消 ] [ 确定退出 ]
        ↓
    生成会话总结
        ↓
    总结发送到日常聊天
        ↓
    AI对此做出回复
```

#### F8.2 总结卡片

```
┌─────────────────────────────────────┐
│ 🎵 一起听结束                        │
├─────────────────────────────────────┤
│                                     │
│ 时长: 45分钟                        │
│ 共听: 12首歌                        │
│                                     │
│ 最常播放:                           │
│ 🖼️ 晴天 - 周杰伦 (播放3次)         │
│                                     │
│ TA 最喜欢的:                        │
│ 🖼️ 稻香 - 周杰伦                   │
│                                     │
│ 精彩瞬间:                           │
│ "这段副歌你也觉得特别好听吗？"      │
│                                     │
└─────────────────────────────────────┘
```

#### F8.3 上下文传递

结束时系统会向 AI 发送的信息：

```json
{
  "event": "listen_together_ended",
  "duration_minutes": 45,
  "songs_played": 12,
  "favorite_song": "晴天 - 周杰伦",
  "chat_summary": "讨论了关于夏天的回忆...",
  "mood": "happy"
}
```

AI 基于此 + 世界书 + 人设 + 记忆支票，生成自然的结束回复。

---

### F9. 快速分享卡片

不进入一起听，直接在聊天中分享歌曲：

```
┌─────────────────────────────────────┐
│ 🎵                                  │
│ ┌─────────┐                         │
│ │  封面   │  晴天                   │
│ │         │  周杰伦                 │
│ │         │  叶惠美 · 2003          │
│ └─────────┘                         │
│                                     │
│ [ ▶ 一起听 ]     [ 🔗 打开链接 ]    │
└─────────────────────────────────────┘
```

---

## 🎨 原型图构想（描述，给专业 AI 用）

以下是详细的原型描述，可以直接给设计 AI 生成原型：

---

### 原型 1：功能入口

**场景**：聊天界面底部加号菜单展开状态

**描述**：

- 风格：iOS 毛玻璃风格，圆角卡片
- 菜单项：现有的相册、位置等图标 + 新增 🎵"一起听"图标
- 配色：主题色为紫色渐变，符合音乐氛围
- 图标：🎵 音符图标，hover 有微微跳动动效

---

### 原型 2：邀请卡片

**场景**：聊天消息流中的邀请卡片

**描述**：

- 卡片样式：圆角矩形，柔和阴影，微微发光边框
- 尺寸：宽度占聊天气泡 80%，高度自适应
- 内容：
  - 顶部：🎧 耳机图标 + "邀请 TA 一起听音乐"
  - 中部：浪漫插画背景（音符飘动）
  - 底部：两个按钮"接受 ✓"和"拒绝 ✗"
- 动效：卡片出现时有轻微缩放弹入效果
- 配色：渐变紫粉色调

---

### 原型 3：一起听沉浸界面

**场景**：全屏沉浸式音乐播放界面

**描述**：

- 整体风格：深色背景 + 模糊效果 + 流光渐变
- 布局：上中下三段式
  - **顶部导航**：左侧"← 最小化"文字链接，右侧"一起听 🎵"标题
  - **中部播放区**：
    - 大尺寸专辑封面（圆角正方形，带阴影）
    - 封面周围：音频可视化光环动效
    - 封面下方：歌曲名（大字）+ 歌手名（小字灰色）
    - 进度条：圆角长条，已播放部分渐变色，可拖动圆点
    - 播放控制：⏮️ ▶️/⏸️ ⏭️ 🔀 📋，居中排列
  - **底部聊天区**：
    - 标题："💬 和 TA 聊聊这首歌..."
    - 聊天气泡区：滚动展示，AI 消息左侧，用户消息右侧
    - 输入框：圆角输入框 + 发送按钮
    - 退出按钮：底部居中"🚪 退出一起听"
- 配色：深紫/深蓝渐变背景，强调色用青紫色
- 动效：背景有缓慢流动的渐变，封面有呼吸感光晕

---

### 原型 4：音乐搜索弹窗

**场景**：点击 📋 歌单图标后弹出的搜索弹窗

**描述**：

- 弹窗样式：从底部滑入，覆盖 70%屏幕，顶部圆角
- 布局：
  - 顶部搜索栏：🔍 图标 + 输入框 + 取消按钮
  - 热门推荐：横向滚动的专辑封面小卡片
  - 搜索结果：纵向列表，每项包含封面缩略图+歌名+歌手+添加按钮
- 交互：输入时实时搜索，点击添加立即加入歌单

---

### 原型 5：共享歌单

**场景**：点击 📋 歌单图标后的歌单管理界面

**描述**：

- 弹窗样式：同搜索弹窗，底部滑入
- 标题："📋 我们的歌单"
- 歌单列表：
  - 每项：封面+歌名+歌手+来源标签（"你添加的"/"TA 添加的 ✨"）
  - AI 想删除的项：显示删除图标+确认提示
  - 左滑删除：用户可左滑删除自己添加的歌
- 底部：
  - "+ 添加歌曲"按钮（跳转搜索）
  - "🔀 随机播放"按钮

---

### 原型 6：浮动音乐胶囊

**场景**：最小化一起听后，显示在日常聊天界面的浮动控件

**描述**：

- 形状：胶囊形（圆角长方形），悬浮在屏幕右下角
- 内容：🎵 图标 + 歌曲名（可滚动显示）+ 播放/暂停小按钮
- 尺寸：高约 40px，宽约 150px
- 动效：轻微呼吸动效，表示正在播放
- 交互：
  - 点击：展开回到沉浸界面
  - 长按：显示快捷菜单（暂停/切歌/退出）
  - 拖拽：可拖动到屏幕边缘

---

### 原型 7：退出总结卡片

**场景**：退出一起听后，在日常聊天中显示的总结卡片

**描述**：

- 卡片样式：与邀请卡片一致的精致风格
- 内容：
  - 标题："🎵 一起听结束"
  - 统计：时长、歌曲数
  - 最喜欢的歌：显示封面+歌名
  - 精彩瞬间：引用一句聊天内容
- 配色：温馨的暖色调渐变

---

### 原型 8：音乐分享卡片

**场景**：聊天消息中的单曲分享卡片

**描述**：

- 形状：圆角矩形卡片
- 内容：
  - 左侧：专辑封面（正方形，圆角）
  - 右侧：歌名（大字）+ 歌手名 + 专辑名·年份
  - 底部：两个按钮"▶ 一起听"和"🔗 打开链接"
- 动效：hover 时卡片轻微上浮

---

## 🔧 技术架构概要

### 前端架构

```
src/
├── components/
│   ├── music/
│   │   ├── ListenTogetherScreen.js    # 沉浸主界面
│   │   ├── MusicSearchModal.js        # 搜索弹窗
│   │   ├── PlaylistPanel.js           # 歌单面板
│   │   ├── FloatingCapsule.js         # 浮动胶囊
│   │   ├── InviteCard.js              # 邀请卡片
│   │   ├── MusicShareCard.js          # 分享卡片
│   │   └── SessionSummaryCard.js      # 总结卡片
├── services/
│   └── music/
│       ├── MusicAPI.js                # 音乐平台API封装
│       ├── PlaybackManager.js         # 播放控制
│       └── ListenTogetherSession.js   # 会话管理
├── stores/
│   └── musicStore.js                  # 音乐状态管理
└── styles/
    └── music/
        └── listen-together.css        # 音乐相关样式
```

### 数据存储

| 数据类型    | 存储位置     | 说明                      |
| ----------- | ------------ | ------------------------- |
| 歌单数据    | IndexedDB    | 歌曲 ID、元数据，不存音频 |
| 会话历史    | IndexedDB    | 一起听聊天记录、统计      |
| 用户偏好    | localStorage | 音量、播放模式等          |
| OAuth Token | 加密存储     | Spotify/Apple Music 授权  |

---

## 📅 后续规划

| 阶段        | 内容                    | 预估工作量 |
| ----------- | ----------------------- | ---------- |
| **Phase 1** | 邀请卡片 + 基础 UI 框架 | 3-5 天     |
| **Phase 2** | 音乐搜索（仅元数据）    | 2-3 天     |
| **Phase 3** | 分享卡片 + 链接跳转     | 1-2 天     |
| **Phase 4** | Spotify SDK 集成        | 3-5 天     |
| **Phase 5** | AI 反馈系统             | 3-5 天     |
| **Phase 6** | 浮动胶囊 + 多任务       | 2-3 天     |
| **Phase 7** | 润色与测试              | 3-5 天     |

**总计预估**：17-28 个工作日

---

## ✅ 检查清单

- [ ] 确认 Spotify 开发者账号申请
- [ ] 确认隐私政策更新
- [ ] 确认原型图设计
- [ ] 确认优先级排序
- [ ] 开始 Phase 1 开发

---

> 📝 **文档说明**  
> 本 PRD 为初版草稿，请审阅后提出修改意见。
> 原型图描述部分可直接发给设计 AI 生成视觉稿。
